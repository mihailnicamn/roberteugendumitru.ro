name: test-aws
on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
    build:
      name: Build
      runs-on: ubuntu-latest
      steps:
      - name: copy files to server
        uses: appleboy/scp-action@master
        with:
          host: ${{secrets.SSHHOST}}
          username: ${{secrets.SSHUSER}}
          key: ${{secrets.SSHKEY}}
          port: ${{secrets.SSHPORT}}
          source: "**/*"
          target: "/root/app"
      - name: executing remote ssh commands using password
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{secrets.SSHHOST}}
          username: ${{secrets.SSHUSER}}
          key: ${{secrets.SSHKEY}}
          port: ${{secrets.SSHPORT}}
          script: bash ./scripts/deploy.sh